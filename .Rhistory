knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plyr) # for data encoding
library(mltools)# for one_hot()
library(data.table) # for as.data.table()
library(caTools) # for data partitioning
library(FSelector) # for feature Selection
library(caret) # for computing Confusion matrix
library(pROC) # for ROC chart
library(CustomerScoringMetrics) #for gain chart
library(e1071) # for SVM
library(randomForest) # for Random Forest
# Import data and save it as data
data <- read.csv("assignment_data.csv", stringsAsFactors = T)
# Check the structure of the variables in the dataset by using str() function
str(data)
# Check the summary of the dataset
summary(data)
# Note: When creating an email marketing campaign and predicting whether customers will be the target group, we cannot know the total amount spent during the period of email marketing campaign in advance. So we need to delete "spend". In addition,  "Customer_ID" and "account" should be removes as well, since they are useless for our model.
# Remove unrelated variables: Customer_ID, account, spend
data[c("Customer_ID", "account","spend")] <- NULL
# Generate a vector to keep the column names
columns <- c("delivery", "marriage", "visit")
# Set the correct measurement levels or data types
data[columns] <- lapply(data[columns], as.factor)
# Apply label encoding to "delivery", "marriage"
data$delivery <- revalue(data$delivery, c("1" = "home", "2" = "work", "3" = "multiple"))
data$marriage <- revalue(data$marriage, c("1" = "married", "2" = "single", "0" = "others"))
# Replace missing values of "purchase_segment" according to "purchase"
data$purchase_segment <- ifelse(!is.na(data$purchase_segment),data$purchase_segment, ifelse(data$purchase>1000, "7", ifelse(data$purchase>750, "6", ifelse(data$purchase>500, "5", ifelse(data$purchase>350, "4", ifelse(data$purchase>200, "3", ifelse(data$purchase, "2", "1")))))))
# Save "purchase_segment" as a numerical variable
data$purchase_segment <- as.numeric(data$purchase_segment)
# Check the structure of the dataset again
str(data)
# Data quality checks and visualisation of continuous variables
# Use bar chart and boxplot to check "purchase", "age"
## First examine "purchase".
ggplot(data) + geom_histogram(aes(purchase), bins = 50)
boxplot(data$purchase)
filter(data, purchase>3000)
# Also examine "age"
ggplot(data) + geom_histogram(aes(age), bins = 50)
boxplot(data$age)
# Note: from the plots we can see there are some values which seems like outliers but reasonable, so we don't need to handle them.
# Apply one hot encoding to the nominal variable "zip_area", "channel", "email_segment", "delivery", "marriage"
data_new <- one_hot(as.data.table(data), cols=c("zip_area","channel", "email_segment","delivery", "marriage" ))
summary(data_new)
